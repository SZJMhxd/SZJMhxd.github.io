<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="SpringBoot前后端分离Token验证"><meta name="keywords" content="SpringBoot前后端分离,Token验证,Redis"><meta name="author" content="十早九木"><meta name="copyright" content="十早九木"><title>SpringBoot前后端分离Token验证 | 十早九木のBlog</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.1"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css?version=1.9.1"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  hexoVersion: '6.2.0'
} </script><meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="十早九木のBlog" type="application/atom+xml">
</head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="切换文章详情">切换站点概览</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringBoot%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BBToken%E9%AA%8C%E8%AF%81"><span class="toc-number">1.</span> <span class="toc-text">SpringBoot前后端分离Token验证</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%87%E7%A8%8B%E5%9B%BE"><span class="toc-number">1.1.</span> <span class="toc-text">过程图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AFToken%E7%9B%B8%E5%85%B3"><span class="toc-number">1.2.</span> <span class="toc-text">后端Token相关</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81"><span class="toc-number">1.2.1.</span> <span class="toc-text">代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%BC%94%E7%A4%BA"><span class="toc-number">1.2.2.</span> <span class="toc-text">演示</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-number">1.3.</span> <span class="toc-text">后端拦截器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81-1"><span class="toc-number">1.3.1.</span> <span class="toc-text">代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%BC%94%E7%A4%BA-1"><span class="toc-number">1.3.2.</span> <span class="toc-text">演示</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%91%E7%8E%B0Bug"><span class="toc-number">1.3.3.</span> <span class="toc-text">发现Bug</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E5%A4%8DBug%E5%90%8E%E5%86%8D%E6%AC%A1%E6%BC%94%E7%A4%BA"><span class="toc-number">1.3.4.</span> <span class="toc-text">修复Bug后再次演示</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-number">1.4.</span> <span class="toc-text">前端拦截器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%98%E5%82%A8token"><span class="toc-number">1.4.1.</span> <span class="toc-text">存储token</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E6%8B%A6%E6%88%AA"><span class="toc-number">1.4.2.</span> <span class="toc-text">全局拦截</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%91%E7%8E%B0Bug-1"><span class="toc-number">1.4.3.</span> <span class="toc-text">发现Bug</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E5%A4%8DBug%E5%90%8E%E5%86%8D%E6%AC%A1%E6%B5%8B%E8%AF%95"><span class="toc-number">1.4.4.</span> <span class="toc-text">修复Bug后再次测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E6%9C%9F%E4%BC%98%E5%8C%96"><span class="toc-number">2.</span> <span class="toc-text">后期优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#token%E6%97%B6%E9%97%B4%E9%87%8D%E7%BD%AE"><span class="toc-number">2.1.</span> <span class="toc-text">token时间重置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%80%E5%87%BA%E6%97%B6%E6%B8%85%E9%99%A4%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE"><span class="toc-number">2.2.</span> <span class="toc-text">退出时清除用户数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%91%E7%8E%B0bug"><span class="toc-number">2.2.1.</span> <span class="toc-text">发现bug</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">2.3.</span> <span class="toc-text">优化过滤器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Controller%E6%8E%A5%E5%8F%A3%E5%B1%82"><span class="toc-number">2.3.1.</span> <span class="toc-text">Controller接口层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MyMvcConfig%E9%85%8D%E7%BD%AE"><span class="toc-number">2.3.2.</span> <span class="toc-text">MyMvcConfig配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Token%E5%A4%B1%E6%95%88%E8%B7%B3%E8%BD%AC"><span class="toc-number">2.4.</span> <span class="toc-text">Token失效跳转</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B0%E5%BB%BAunlogin-html"><span class="toc-number">2.4.1.</span> <span class="toc-text">新建unlogin.html</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-number">2.4.2.</span> <span class="toc-text">修改拦截器</span></a></li></ol></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">十早九木</div><div class="author-info__description text-center"></div><div class="follow-button"><a target="_blank" rel="noopener" href="https://github.com/szjmhxd">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">文章</span><span class="pull-right">74</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">标签</span><span class="pull-right">30</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">分类</span><span class="pull-right">47</span></a></div></div></div><div id="content-outer"><div class="no-bg" id="top-container"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">十早九木のBlog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">主页</a><a class="site-page" href="/archives">时间线</a><a class="site-page" href="/tags">标签</a><a class="site-page" href="/categories">分类</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">SpringBoot前后端分离Token验证</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-02-13</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E5%B7%A5%E4%BD%9C/">工作</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E5%B7%A5%E4%BD%9C/%E6%99%BA%E5%B0%A7/">智尧</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E5%B7%A5%E4%BD%9C/%E6%99%BA%E5%B0%A7/SpringBoot/">SpringBoot</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E5%B7%A5%E4%BD%9C/%E6%99%BA%E5%B0%A7/SpringBoot/Token%E9%AA%8C%E8%AF%81/">Token验证</a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h2 id="SpringBoot前后端分离Token验证"><a href="#SpringBoot前后端分离Token验证" class="headerlink" title="SpringBoot前后端分离Token验证"></a>SpringBoot前后端分离Token验证</h2><h3 id="过程图"><a href="#过程图" class="headerlink" title="过程图"></a>过程图<span id="more"></span></h3><ul>
<li>登录 <img src="/2022/02/13/Spring/SpringBoot/SpringBoot%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BBToken%E9%AA%8C%E8%AF%81/登录流程.png"></li>
<li>访问 <img src="/2022/02/13/Spring/SpringBoot/SpringBoot%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BBToken%E9%AA%8C%E8%AF%81/访问流程.png"></li>
<li>退出 <img src="/2022/02/13/Spring/SpringBoot/SpringBoot%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BBToken%E9%AA%8C%E8%AF%81/退出流程.png"></li>
</ul>
<h3 id="后端Token相关"><a href="#后端Token相关" class="headerlink" title="后端Token相关"></a>后端Token相关</h3><p>参考 <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1kE411J7JQ">【Token】01.令牌的生成与存储_哔哩哔哩_bilibili</a></p>
<h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><ol>
<li><p>Maven依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>application.properties配置</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#redis</span></span><br><span class="line"><span class="comment">##指定使用redis数据库索引(默认为0)</span></span><br><span class="line"><span class="attr">spring.redis.database</span>=<span class="string">0</span></span><br><span class="line"><span class="comment">##指定Redis服务器地址</span></span><br><span class="line"><span class="attr">spring.redis.host</span>=<span class="string">127.0.0.1</span></span><br><span class="line"><span class="comment">##指定Redis端口号</span></span><br><span class="line"><span class="attr">spring.redis.port</span>=<span class="string">6379</span></span><br><span class="line"><span class="comment">##指定Redis密码 （没有可以不写）</span></span><br><span class="line"><span class="comment">#spring.redis.password=123456</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>后端Token上传</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;LoginToken&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">LoginToken</span><span class="params">(<span class="meta">@RequestParam(&quot;user_name&quot;)</span> String acctName, <span class="meta">@RequestParam(&quot;user_password&quot;)</span> String acctPass)</span> &#123;</span><br><span class="line">    Map&lt;String, Object&gt; map_res = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Object&gt;();</span><br><span class="line">    <span class="type">UserBean</span> <span class="variable">userBean</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    System.out.println(<span class="string">&quot;+++++地址栏获取：+++++&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;用户名：&quot;</span> + acctName);</span><br><span class="line">    System.out.println(<span class="string">&quot;密码：&quot;</span> + acctPass);</span><br><span class="line">    System.out.println(<span class="string">&quot;++++++++++++++++++++&quot;</span>);</span><br><span class="line"> 	<span class="comment">//与数据库确认用户信息</span></span><br><span class="line">    userBean = loginService.findUser(acctName, acctPass);</span><br><span class="line">    <span class="keyword">if</span> (userBean != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">userId</span> <span class="operator">=</span> userBean.getUser_id();</span><br><span class="line">        <span class="comment">//生成token令牌</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> String.valueOf(UUID.randomUUID());</span><br><span class="line">        System.out.println(token);</span><br><span class="line">        <span class="comment">//存到redis数据库 token 用户名 有效时间</span></span><br><span class="line">        redisTemplate.opsForValue().set(token, JSON.toJSONString(userBean), Duration.ofHours(<span class="number">1</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;登录成功&quot;</span>);</span><br><span class="line">        map_res.put(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;成功&quot;</span>);</span><br><span class="line">        map_res.put(<span class="string">&quot;code&quot;</span>, <span class="string">&quot;200&quot;</span>);</span><br><span class="line">      	map_res.put(<span class="string">&quot;uid&quot;</span>,userId);</span><br><span class="line">		map_res.put(<span class="string">&quot;token&quot;</span>,token);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        map_res.put(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;失败&quot;</span>);</span><br><span class="line">        map_res.put(<span class="string">&quot;code&quot;</span>, <span class="string">&quot;500&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> JSON.toJSONString(map_res);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>后端Token验证</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;getUserOfLogin&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getUserOfLogin</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> UnsupportedEncodingException &#123;</span><br><span class="line">    Map&lt;String, Object&gt; map_res = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">//获取Headers中的参数</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">    <span class="comment">//从Redis中获取信息</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">user</span> <span class="operator">=</span> redisTemplate.opsForValue().get(token);</span><br><span class="line">    System.out.println(user);</span><br><span class="line">    <span class="keyword">if</span> (user != <span class="literal">null</span>) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;用户已登录&quot;</span>);</span><br><span class="line">        map_res.put(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;用户已登录&quot;</span>);</span><br><span class="line">        map_res.put(<span class="string">&quot;code&quot;</span>, <span class="string">&quot;200&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;登录已过期&quot;</span>);</span><br><span class="line">        map_res.put(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;登录已过期&quot;</span>);</span><br><span class="line">        map_res.put(<span class="string">&quot;code&quot;</span>, <span class="string">&quot;500&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> JSON.toJSONString(map_res);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>后端Token删除</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;loginout&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">logout</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">    Map&lt;String, Object&gt; map_res = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//删除Redis中的token</span></span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">delete</span> <span class="operator">=</span> redisTemplate.delete(token);</span><br><span class="line">        System.out.println(<span class="string">&quot;登录已注销&quot;</span>);</span><br><span class="line">        map_res.put(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;登录已注销&quot;</span>);</span><br><span class="line">        map_res.put(<span class="string">&quot;code&quot;</span>, <span class="string">&quot;200&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception exception) &#123;</span><br><span class="line">        exception.printStackTrace();</span><br><span class="line">        System.out.println(<span class="string">&quot;注销失败&quot;</span>);</span><br><span class="line">        map_res.put(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;注销失败&quot;</span>);</span><br><span class="line">        map_res.put(<span class="string">&quot;code&quot;</span>, <span class="string">&quot;500&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> JSON.toJSONString(map_res);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="演示"><a href="#演示" class="headerlink" title="演示"></a>演示</h4><ol>
<li><p>登录</p>
<img src="/2022/02/13/Spring/SpringBoot/SpringBoot%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BBToken%E9%AA%8C%E8%AF%81/后端Token登录演示-Postman.png">

<img src="/2022/02/13/Spring/SpringBoot/SpringBoot%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BBToken%E9%AA%8C%E8%AF%81/后端Token登录演示-Redis.png">
</li>
<li><p>验证</p>
<img src="/2022/02/13/Spring/SpringBoot/SpringBoot%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BBToken%E9%AA%8C%E8%AF%81/后端Token验证演示-Postman.png">
</li>
<li><p>退出</p>
<img src="/2022/02/13/Spring/SpringBoot/SpringBoot%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BBToken%E9%AA%8C%E8%AF%81/后端Token登录注销演示-Postman.png">

<img src="/2022/02/13/Spring/SpringBoot/SpringBoot%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BBToken%E9%AA%8C%E8%AF%81/后端Token登录注销演示-Redis.png"></li>
</ol>
<h3 id="后端拦截器"><a href="#后端拦截器" class="headerlink" title="后端拦截器"></a>后端拦截器</h3><p>参考 <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV19E411v7Ty?p=12">【狂神说Java】SpringBoot开发简单的网站_哔哩哔哩_bilibili</a></p>
<h4 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h4><ol>
<li><p>新建<code>config</code>文件夹</p>
</li>
<li><p>拦截器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginHandlerInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request,</span></span><br><span class="line"><span class="params">                             HttpServletResponse response,</span></span><br><span class="line"><span class="params">                             Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Map&lt;String, Object&gt; map_res = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//获取Headers中的参数</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;token: &quot;</span> + token);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//在redis中用token检索信息</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">user</span> <span class="operator">=</span> redisTemplate.opsForValue().get(token);</span><br><span class="line">        System.out.println(<span class="string">&quot;user: &quot;</span> + user);</span><br><span class="line">        <span class="keyword">if</span> (user != <span class="literal">null</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;用户已登录200&quot;</span>);</span><br><span class="line">            map_res.put(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;用户已登录&quot;</span>);</span><br><span class="line">            map_res.put(<span class="string">&quot;code&quot;</span>, <span class="string">&quot;200&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;登录已过期500&quot;</span>);</span><br><span class="line">            map_res.put(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;登录已过期&quot;</span>);</span><br><span class="line">            map_res.put(<span class="string">&quot;code&quot;</span>, <span class="string">&quot;500&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>MVC配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyMvcConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="comment">//自定义拦截器 拦截所有 但是排除excludePathPatterns</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">LoginHandlerInterceptor</span>()).addPathPatterns(<span class="string">&quot;/**&quot;</span>).excludePathPatterns(<span class="string">&quot;/fvcs/LoginToken&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="演示-1"><a href="#演示-1" class="headerlink" title="演示"></a>演示</h4><ol>
<li><p>登录</p>
<p>由于我们在自定义的拦截器里排除了登录接口 所以仍然可以登录</p>
<img src="/2022/02/13/Spring/SpringBoot/SpringBoot%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BBToken%E9%AA%8C%E8%AF%81/过滤器登录演示-Postman.png">
</li>
<li><p>携带Token访问</p>
<img src="/2022/02/13/Spring/SpringBoot/SpringBoot%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BBToken%E9%AA%8C%E8%AF%81/过滤器访问演示-Postman.png"></li>
</ol>
<h4 id="发现Bug"><a href="#发现Bug" class="headerlink" title="发现Bug"></a>发现Bug</h4><p>我们查看日志 发现获取到了token值 Redis中也存在相关信息 但是获取不到数据 </p>
<p>获取到了token   <img src="/2022/02/13/Spring/SpringBoot/SpringBoot%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BBToken%E9%AA%8C%E8%AF%81/过滤器访问演示-获取到Token.png"></p>
<p>获取不到redis的信息</p>
<img src="/2022/02/13/Spring/SpringBoot/SpringBoot%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BBToken%E9%AA%8C%E8%AF%81/过滤器访问演示-Redis空值.png">

<p>在网上搜索后发现解决办法<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_48445961/article/details/116462520"> 拦截器中使用redisTemplate获取数据报空指针</a></p>
<p><strong>自定义一个工具类，让它在注入容器时就生效，在拦截器中只需要使用该工具类即可</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//如果不使用这个注入 拦截器获取不到redis的值</span></span><br><span class="line"><span class="meta">@Component</span> <span class="comment">//项目运行时就注入Spring容器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisUtils</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//赋值一个静态的redisTemplate</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> RedisTemplate redis;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span> <span class="comment">//此注解表示构造时赋值</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">redisTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">        redis = <span class="built_in">this</span>.redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同时修改拦截器</p>
<p>修改</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">user</span> <span class="operator">=</span> redisTemplate.opsForValue().get(token);</span><br></pre></td></tr></table></figure>

<p>为</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Object</span> <span class="variable">user</span> <span class="operator">=</span> RedisUtils.redis.opsForValue().get(token);</span><br></pre></td></tr></table></figure>
<p>因为使用了自定义工具类所以可以删除</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br></pre></td></tr></table></figure>
<h4 id="修复Bug后再次演示"><a href="#修复Bug后再次演示" class="headerlink" title="修复Bug后再次演示"></a>修复Bug后再次演示</h4><ol>
<li><p>携带Token访问</p>
<p>可以下载到图片</p>
<img src="/2022/02/13/Spring/SpringBoot/SpringBoot%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BBToken%E9%AA%8C%E8%AF%81/修复bug访问演示-正确Token.png">
</li>
<li><p>携带错误Token访问</p>
<p>下载不到图片 后端提示<code>登录已过期</code></p>
<img src="/2022/02/13/Spring/SpringBoot/SpringBoot%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BBToken%E9%AA%8C%E8%AF%81/修复bug访问演示-错误Token.png">

<img src="/2022/02/13/Spring/SpringBoot/SpringBoot%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BBToken%E9%AA%8C%E8%AF%81/修复bug访问演示-错误Token后端.png">
</li>
<li><p>不携带Token访问</p>
<p>下载不到图片 网页提示<code>500</code> 后端报错</p>
<img src="/2022/02/13/Spring/SpringBoot/SpringBoot%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BBToken%E9%AA%8C%E8%AF%81/修复bug访问演示-无Token.png">

<img src="/2022/02/13/Spring/SpringBoot/SpringBoot%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BBToken%E9%AA%8C%E8%AF%81/修复bug访问演示-无Token后端.png">
</li>
<li><p>网页访问</p>
<p>下载不到图片 网页提示<code>500</code> 后端报错</p>
<p><img src="/SpringBoot%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BBToken%E9%AA%8C%E8%AF%81/image-20220213184511775.png" alt="image-20220213184511775"><img src="/SpringBoot%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BBToken%E9%AA%8C%E8%AF%81/image-20220213184636569.png" alt="image-20220213184636569"></p>
<p>因为浏览器的请求头里没有携带Token值<img src="/SpringBoot%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BBToken%E9%AA%8C%E8%AF%81/image-20220213185101448.png" alt="image-20220213185101448"></p>
</li>
</ol>
<h3 id="前端拦截器"><a href="#前端拦截器" class="headerlink" title="前端拦截器"></a>前端拦截器</h3><blockquote>
<p>因为我们拦截了所有请求 所以对每一个请求添加token值不太现实 所以我们需要用到vue的拦截器</p>
</blockquote>
<p>参考 <a target="_blank" rel="noopener" href="https://www.axios-http.cn/docs/interceptors">拦截器 | Axios 中文文档 | Axios 中文网 (axios-http.cn)</a></p>
<p>​		<a target="_blank" rel="noopener" href="https://blog.csdn.net/yuanchangliang/article/details/110501306">Vue:全局拦截所有请求，并在请求头中添加token_yuanchangliang的博客-CSDN博客_vue怎么将token添加到请求头</a></p>
<h4 id="存储token"><a href="#存储token" class="headerlink" title="存储token"></a>存储token</h4><p>现在我们的浏览器会话存储没有存储token值</p>
<p><img src="/SpringBoot%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BBToken%E9%AA%8C%E8%AF%81/image-20220214104312254.png" alt="image-20220214104312254"></p>
<p>修改登录代码</p>
<p>在登录方法里的登录成功后增加</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">window.sessionStorage.setItem(&#x27;token&#x27;, res.token);/*session放置，存储*/</span><br></pre></td></tr></table></figure>

<p>再次登录发现存储里新增了token</p>
<p><img src="/SpringBoot%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BBToken%E9%AA%8C%E8%AF%81/image-20220214105246549.png" alt="image-20220214105246549"></p>
<h4 id="全局拦截"><a href="#全局拦截" class="headerlink" title="全局拦截"></a>全局拦截</h4><p>在<code>main.js</code>中新增语句</p>
<p><img src="/SpringBoot%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BBToken%E9%AA%8C%E8%AF%81/image-20220214110603166.png" alt="image-20220214110603166"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加请求拦截器</span></span><br><span class="line">axios.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(<span class="keyword">function</span> (<span class="params">config</span>) &#123;</span><br><span class="line">  <span class="comment">// 在发送请求之前做些什么</span></span><br><span class="line">  <span class="comment">//写个输出测试一下</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;经过拦截器&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> config;</span><br><span class="line">&#125;, <span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line">  <span class="comment">// 对请求错误做些什么</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>浏览器控制台输出了测试语句 说明拦截器生效</p>
<p><img src="/SpringBoot%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BBToken%E9%AA%8C%E8%AF%81/image-20220214115304651.png" alt="image-20220214115304651"></p>
<p>在请求头添加token信息</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加请求拦截器</span></span><br><span class="line">axios.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(<span class="keyword">function</span> (<span class="params">config</span>) &#123;</span><br><span class="line">  <span class="comment">// 在发送请求之前做些什么</span></span><br><span class="line">  <span class="comment">//写个输出测试一下</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;经过拦截器&quot;</span>);</span><br><span class="line">  <span class="comment">// 请求头添加token</span></span><br><span class="line">  config.<span class="property">headers</span>.<span class="property">common</span>[<span class="string">&#x27;token&#x27;</span>] = sessionStorage.<span class="title function_">getItem</span>(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">  <span class="keyword">return</span> config;</span><br><span class="line">&#125;, <span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line">  <span class="comment">// 对请求错误做些什么</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>再次测试 可以访问其他接口 请求头有token 后端正常</p>
<p><img src="/SpringBoot%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BBToken%E9%AA%8C%E8%AF%81/image-20220214135503332.png" alt="image-20220214135503332"></p>
<p><img src="/SpringBoot%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BBToken%E9%AA%8C%E8%AF%81/image-20220214134722387.png" alt="image-20220214134722387"></p>
<h4 id="发现Bug-1"><a href="#发现Bug-1" class="headerlink" title="发现Bug"></a>发现Bug</h4><p>在测试的时候尝试了一下手动F5刷新，然后所有的访问就都被拒了，检查日志后发现时拦截器不生效了导致请求没有携带请求头</p>
<p>上网一番查找发现解决办法<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43288153/article/details/107260223">(Vue 刷新页面后 axios请求拦截器不起作用的解决办法_atrainee的博客-CSDN博客_axios拦截器不起作用</a></p>
<ol>
<li><p>新建<code>http.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加请求拦截器</span></span><br><span class="line">axios.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(<span class="keyword">function</span> (<span class="params">config</span>) &#123;</span><br><span class="line">  <span class="comment">// 在发送请求之前做些什么</span></span><br><span class="line">  <span class="comment">//写个输出测试一下</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;经过拦截器&quot;</span>);</span><br><span class="line">  <span class="comment">// 请求头添加token</span></span><br><span class="line">  config.<span class="property">headers</span>.<span class="property">common</span>[<span class="string">&#x27;token&#x27;</span>] = sessionStorage.<span class="title function_">getItem</span>(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(sessionStorage.<span class="title function_">getItem</span>(<span class="string">&#x27;token&#x27;</span>));</span><br><span class="line">  <span class="keyword">return</span> config;</span><br><span class="line">&#125;, <span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line">  <span class="comment">// 对请求错误做些什么</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改<code>main.js</code></p>
<p>删除</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加请求拦截器</span></span><br><span class="line">axios.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(<span class="keyword">function</span> (<span class="params">config</span>) &#123;</span><br><span class="line">  <span class="comment">// 在发送请求之前做些什么</span></span><br><span class="line">  <span class="comment">//写个输出测试一下</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;经过拦截器&quot;</span>);</span><br><span class="line">  <span class="comment">// 请求头添加token</span></span><br><span class="line">  config.<span class="property">headers</span>.<span class="property">common</span>[<span class="string">&#x27;token&#x27;</span>] = sessionStorage.<span class="title function_">getItem</span>(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(sessionStorage.<span class="title function_">getItem</span>(<span class="string">&#x27;token&#x27;</span>));</span><br><span class="line">  <span class="keyword">return</span> config;</span><br><span class="line">&#125;, <span class="keyword">function</span> (<span class="params">error</span>) &#123;</span><br><span class="line">  <span class="comment">// 对请求错误做些什么</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>添加</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> instance <span class="keyword">from</span> <span class="string">&#x27;./http&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$axios</span> = instance</span><br></pre></td></tr></table></figure>

<h4 id="修复Bug后再次测试"><a href="#修复Bug后再次测试" class="headerlink" title="修复Bug后再次测试"></a>修复Bug后再次测试</h4><p>发现刷新后token请求头仍然存在 bug修复成功</p>
<p><img src="/SpringBoot%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BBToken%E9%AA%8C%E8%AF%81/image-20220214141322823.png" alt="image-20220214141322823"></p>
</li>
</ol>
<h2 id="后期优化"><a href="#后期优化" class="headerlink" title="后期优化"></a>后期优化</h2><h3 id="token时间重置"><a href="#token时间重置" class="headerlink" title="token时间重置"></a>token时间重置</h3><p>​		我们在一开始用户登录的时候为用户分配了能使用一个小时的token，如果用户一个小时内一直在使用，但是一个小时零1秒过去后你还是强制把用户退出了显然不合适</p>
<p>​		在后端过滤器增加代码，用户每次访问其它接口都会重置token的生效时间，只要用户一直在访问，token就不会过期</p>
<p>修改<code>LoginHandlerInterceptor</code> 在token生效的if中增加</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//重置token时间 为30分钟</span></span><br><span class="line">RedisUtils.redis.expire(token,<span class="number">30L</span>, TimeUnit.MINUTES);</span><br></pre></td></tr></table></figure>

<h3 id="退出时清除用户数据"><a href="#退出时清除用户数据" class="headerlink" title="退出时清除用户数据"></a>退出时清除用户数据</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">      logout() &#123;</span><br><span class="line">        // 调用删除token接口</span><br><span class="line">        this.$http.post(&quot;fvcs/loginout&quot;)</span><br><span class="line">        //清除浏览器会话存储</span><br><span class="line">        window.sessionStorage.clear();</span><br><span class="line">        //跳转到登录界面</span><br><span class="line">        this.$router.push(&quot;/login&quot;);</span><br><span class="line">      &#125;,</span><br></pre></td></tr></table></figure>

<p>测试发现redis中的信息没有被删除 浏览器显示在调用<code>loginout</code>接口时token为空</p>
<p><img src="/SpringBoot%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BBToken%E9%AA%8C%E8%AF%81/image-20220214151336170.png" alt="image-20220214151336170"></p>
<h4 id="发现bug"><a href="#发现bug" class="headerlink" title="发现bug"></a>发现bug</h4><p>在前端退出接口输入res发现token值为空的情况下显示删除成功了 </p>
<p>修复bug</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;loginout&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">logout</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">    Map&lt;String, Object&gt; map_res = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//获取Headers中的参数</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">        <span class="comment">//从Redis中获取信息</span></span><br><span class="line">        System.out.println(<span class="string">&quot;token:&quot;</span> + token);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">user</span> <span class="operator">=</span> redisTemplate.opsForValue().get(token);</span><br><span class="line">        System.out.println(<span class="string">&quot;user: &quot;</span> + user);</span><br><span class="line">        <span class="keyword">if</span> (user != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">//删除Redis中的token</span></span><br><span class="line">            <span class="type">Boolean</span> <span class="variable">delete</span> <span class="operator">=</span> redisTemplate.delete(token);</span><br><span class="line">            System.out.println(<span class="string">&quot;登录已注销&quot;</span>);</span><br><span class="line">            System.out.println();</span><br><span class="line">            map_res.put(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;登录已注销&quot;</span>);</span><br><span class="line">            map_res.put(<span class="string">&quot;code&quot;</span>, <span class="string">&quot;200&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;注销失败,token不存在&quot;</span>);</span><br><span class="line">            map_res.put(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;注销失败,token不存在&quot;</span>);</span><br><span class="line">            map_res.put(<span class="string">&quot;code&quot;</span>, <span class="string">&quot;500&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception exception) &#123;</span><br><span class="line">        exception.printStackTrace();</span><br><span class="line">        System.out.println(<span class="string">&quot;注销失败,未获取到token&quot;</span>);</span><br><span class="line">        map_res.put(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;注销失败&quot;</span>);</span><br><span class="line">        map_res.put(<span class="string">&quot;code&quot;</span>, <span class="string">&quot;500&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> JSON.toJSONString(map_res);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>至于没有获取到token值的问题</p>
<p>猜测是因为<code>window.sessionStorage.clear();</code>删除会话后才调用的接口</p>
<p>修改代码 使用<code>async</code>和<code>await</code>异步线程 redis删除完毕后再继续清除会话存储</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">async logout() &#123;</span><br><span class="line">  // 调用删除token接口</span><br><span class="line">  const &#123;data: res&#125; = await this.$http.post(&quot;fvcs/loginout&quot;)</span><br><span class="line">  console.log(res)</span><br><span class="line">  //清除浏览器会话存储</span><br><span class="line">  window.sessionStorage.clear();</span><br><span class="line">  //跳转到登录界面</span><br><span class="line">  this.$router.push(&quot;/login&quot;);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>再次测试 成功 能成功删除token值 使用postman测试也无法使用此token</p>
<p><img src="/SpringBoot%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BBToken%E9%AA%8C%E8%AF%81/image-20220214202703129.png" alt="image-20220214202703129"></p>
<p><img src="/SpringBoot%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BBToken%E9%AA%8C%E8%AF%81/image-20220214202732484.png" alt="image-20220214202732484"></p>
<p><img src="/SpringBoot%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BBToken%E9%AA%8C%E8%AF%81/image-20220214203113349.png" alt="image-20220214203113349"></p>
<h3 id="优化过滤器"><a href="#优化过滤器" class="headerlink" title="优化过滤器"></a>优化过滤器</h3><blockquote>
<p>实际应用中,登录接口,验证接口,退出接口都不需要经过过滤器接受token验证 所以我们把这些不需要经过过滤器的 与登录相关的接口放在&#x2F;user&#x2F;接口注解下</p>
</blockquote>
<h4 id="Controller接口层"><a href="#Controller接口层" class="headerlink" title="Controller接口层"></a>Controller接口层</h4><p>在<code>class</code>外面新增接口注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user/&quot;)</span><span class="comment">//接口注解</span></span><br></pre></td></tr></table></figure>

<h4 id="MyMvcConfig配置"><a href="#MyMvcConfig配置" class="headerlink" title="MyMvcConfig配置"></a>MyMvcConfig配置</h4><p>修改拦截</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">registry.addInterceptor(new LoginHandlerInterceptor()).addPathPatterns(&quot;/**&quot;).excludePathPatterns(&quot;/user/**&quot;);</span><br></pre></td></tr></table></figure>

<p>只要是<code>/user/</code>下的请求都不用经过拦截器</p>
<h3 id="Token失效跳转"><a href="#Token失效跳转" class="headerlink" title="Token失效跳转"></a>Token失效跳转</h3><blockquote>
<p>在没有获取到token或者没有获取到正确token时，浏览器端会直接跳转到登录界面，很突兀</p>
</blockquote>
<p>我们需要一个提示跳转界面做缓冲，类似<a target="_blank" rel="noopener" href="https://item.btime.com/1">北京时间 (btime.com)</a> 现在好多网站404界面不做自动跳转了，而是用来放广告</p>
<p><img src="/SpringBoot%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BBToken%E9%AA%8C%E8%AF%81/image-20220214224725880.png" alt="image-20220214224725880"></p>
<h4 id="新建unlogin-html"><a href="#新建unlogin-html" class="headerlink" title="新建unlogin.html"></a>新建unlogin.html</h4><p>参考 <a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_36050720/article/details/100533704">JavaScript&gt;倒计时自动跳转到首页(指定网页)_越努力，越幸福！-CSDN博客</a></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>未登录跳转<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">span</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">color</span>: <span class="number">#ff0000</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">p</span>&#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    1.显示页面效果--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;color:red;font-size:50px;&quot;</span>&gt;</span>你还没有登录或者登录已过期<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;time&quot;</span>&gt;</span>5<span class="tag">&lt;/<span class="name">span</span>&gt;</span>秒之后，跳转到登录页面...</span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">    如果浏览器没有自动跳转请点击下方连接</span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;text-align: center&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://127.0.0.1:8080/#/login&quot;</span>&gt;</span>回到登录界面<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">/*</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">        分析：</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">            1.显示页面效果</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">            2.倒计时读秒效果实现</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                2.1 定义一个方法，获取span标签，修改span标签内容，时间...</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                2.2 定义一个定时器，1秒执行一次该方法</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">    */</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//2.倒计时读秒效果实现</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> second = <span class="number">5</span>;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//2.1定义一个方法，获取span标签，修改span标签体内容，时间...</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">var</span> time = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;time&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">showTime</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        second --;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//判断时间如果&lt;=0，则跳转到指定页面</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (second &lt;= <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//跳转到指定页面</span></span></span><br><span class="line"><span class="language-javascript">            location.<span class="property">href</span> = <span class="string">&quot;http://127.0.0.1:8080/#/login&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        time.<span class="property">innerHTML</span> = second + <span class="string">&quot;&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">//2.2 定义一个定时器，1秒执行一次该方法</span></span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setInterval</span>(showTime,<span class="number">1000</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/SpringBoot%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BBToken%E9%AA%8C%E8%AF%81/image-20220214231219844.png" alt="image-20220214231219844"></p>
<h4 id="修改拦截器"><a href="#修改拦截器" class="headerlink" title="修改拦截器"></a>修改拦截器</h4><ul>
<li><p>修改MVC配置</p>
<p>为未登录跳转的html界面设置地址使其可以被访问</p>
</li>
<li><p>修改拦截器</p>
</li>
<li><p>01</p>
</li>
</ul>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">十早九木</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://www.szjm.online/2022/02/13/Spring/SpringBoot/SpringBoot前后端分离Token验证/">https://www.szjm.online/2022/02/13/Spring/SpringBoot/SpringBoot前后端分离Token验证/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.szjm.online">十早九木のBlog</a>！</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SpringBoot%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB/">SpringBoot前后端分离</a><a class="post-meta__tags" href="/tags/Token%E9%AA%8C%E8%AF%81/">Token验证</a><a class="post-meta__tags" href="/tags/Redis/">Redis</a></div><div class="post-qr-code"><div class="post-qr-code-item"><img class="post-qr-code__img" src="微信收款码.jpg"><div class="post-qr-code__desc">来杯奶茶吧</div></div><div class="post-qr-code-item"><img class="post-qr-code__img" src="支付宝收款码.jpg"><div class="post-qr-code__desc">圣代我也喜欢</div></div></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2022/02/22/JAVA/02%E5%9F%BA%E7%A1%80/Java%E5%9F%BA%E7%A1%8004_%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E6%89%A9%E5%B1%95%E5%8F%8A%E9%9D%A2%E8%AF%95%E9%A2%98%E8%AE%B2%E8%A7%A3/"><i class="fa fa-chevron-left">  </i><span>数据类型扩展及面试题讲解</span></a></div><div class="next-post pull-right"><a href="/2022/02/08/JAVA/02%E5%9F%BA%E7%A1%80/Java%E5%9F%BA%E7%A1%8003_%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E8%AE%B2%E8%A7%A3/"><span>数据类型讲解</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2020 - 2022 By 十早九木</div><div class="framework-info"><span>驱动 - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/lib/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.1"></script><script src="/js/fancybox.js?version=1.9.1"></script><script src="/js/sidebar.js?version=1.9.1"></script><script src="/js/copy.js?version=1.9.1"></script><script src="/js/fireworks.js?version=1.9.1"></script><script src="/js/transition.js?version=1.9.1"></script><script src="/js/scroll.js?version=1.9.1"></script><script src="/js/head.js?version=1.9.1"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>